<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo - Santa Teresa</title>
  <link rel="stylesheet" href="css/admin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="header-full">
    <nav class="nav-full">
      <div class="logo-main"><a href="index.html">Santa Teresa</a></div>
      <ul class="nav-links-main">
        <li><a href="#" id="logoutBtn">Sair</a></li>
        <li><a href="index.html">Voltar ao Site</a></li>
      </ul>
    </nav>
  </header>

  <main class="main-full">
    <section class="admin-hero">
      <div class="container">
        <h1>Painel Administrativo</h1>
        <p>Bem-vindo, Administrador!</p>
      </div>
    </section>

    <section class="admin-dashboard">
      <div class="container">
        <div class="dashboard-grid">
          <!-- Card de Reservas -->
          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
            <h3>Reservas</h3>
            <p class="card-number" id="total-reservas">0</p>
            <p class="card-label">Reservas ativas</p>
            <button class="card-btn" onclick="viewReservations()">Ver Detalhes</button>
          </div>

          <!-- Card de Usuários -->
          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fas fa-users"></i>
            </div>
            <h3>Usuários</h3>
            <p class="card-number" id="total-usuarios">0</p>
            <p class="card-label">Usuários cadastrados</p>
            <button class="card-btn" onclick="viewUsers()">Gerenciar</button>
          </div>

          <!-- Card de Quartos -->
          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fas fa-bed"></i>
            </div>
            <h3>Quartos</h3>
            <p class="card-number" id="total-quartos">0</p>
            <p class="card-label">Quartos disponíveis</p>
            <button class="card-btn" onclick="manageRooms()">Configurar</button>
          </div>

          <!-- Card de Financeiro -->
          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <h3>Financeiro</h3>
            <p class="card-number" id="total-receita">R$ 0</p>
            <p class="card-label">Receita total</p>
            <button class="card-btn" onclick="viewFinancial()">Relatórios</button>
          </div>
        </div>

        <!-- Seção de Reservas Recentes -->
        <div class="recent-section">
          <h2>Reservas Recentes</h2>
          <div class="reservations-table">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Hóspede</th>
                  <th>Quarto</th>
                  <th>Check-in</th>
                  <th>Check-out</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="reservas-recentes">
                <!-- Dados serão carregados via JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer-main">
    <div class="footer-content">
      <p>&copy; 2025 Albergue do Seu Almeida</p>
      <p>Painel Administrativo</p>
    </div>
  </footer>

  <script>
    // Verificar se é administrador
    function checkAdminAccess() {
      const isAdmin = sessionStorage.getItem('is_admin') === 'true';
      if (!isAdmin) {
        window.location.href = 'login.html';
        return false;
      }
      return true;
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', function(e) {
      e.preventDefault();
      sessionStorage.removeItem('is_admin');
      window.location.href = 'login.html';
    });

    // Carregar dados do dashboard
    async function carregarDashboard() {
      try {
        const response = await fetch('php/get_dashboard_data.php');
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('total-reservas').textContent = data.total_reservas;
          document.getElementById('total-usuarios').textContent = data.total_usuarios;
          document.getElementById('total-quartos').textContent = data.total_quartos;
          document.getElementById('total-receita').textContent = 'R$ ' + data.total_receita;
        } else {
          console.error('Erro ao carregar dados:', data.message);
        }
      } catch (error) {
        console.error('Erro ao carregar dashboard:', error);
      }
    }

    // Carregar reservas recentes
    async function carregarReservasRecentes() {
      try {
        const response = await fetch('php/get_recent_reservations.php');
        const data = await response.json();
        
        if (data.success) {
          const tbody = document.getElementById('reservas-recentes');
          tbody.innerHTML = '';
          
          data.reservas.forEach(reserva => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>#${reserva.id}</td>
              <td>${reserva.nome}</td>
              <td>${reserva.quarto} - ${reserva.cama}</td>
              <td>${formatarData(reserva.checkin)}</td>
              <td>${formatarData(reserva.checkout)}</td>
              <td><span class="status ${reserva.status}">${formatarStatus(reserva.status)}</span></td>
              <td>
                <button class="action-btn view" onclick="verReserva(${reserva.id})">Ver</button>
                <button class="action-btn edit" onclick="editarReserva(${reserva.id})">Editar</button>
                ${reserva.status === 'pendente' ? 
                  '<button class="action-btn confirm" onclick="confirmarReserva(' + reserva.id + ')">Confirmar</button>' : 
                  ''
                }
              </td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          console.error('Erro ao carregar reservas:', data.message);
        }
      } catch (error) {
        console.error('Erro ao carregar reservas recentes:', error);
      }
    }

    // Funções auxiliares
    function formatarData(data) {
      return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
    }

    function formatarStatus(status) {
      const statusMap = {
        'pendente': 'Pendente',
        'confirmada': 'Confirmada',
        'cancelada': 'Cancelada',
        'concluida': 'Concluída',
        'ativa': 'Ativa'
      };
      return statusMap[status] || status;
    }

    // Funções de ação
    function verReserva(id) {
      alert(`Visualizar reserva #${id}`);
      // Implementar modal de visualização
    }

    function editarReserva(id) {
      alert(`Editar reserva #${id}`);
      // Implementar edição
    }

    function confirmarReserva(id) {
      if (confirm(`Confirmar reserva #${id}?`)) {
        // Implementar confirmação via AJAX
        alert(`Reserva #${id} confirmada!`);
        location.reload();
      }
    }

    // Funções dos botões (placeholders)
    function viewReservations() {
      alert('Abrindo gerenciamento de reservas...');
      // Implementar navegação para página de reservas
    }

    function viewUsers() {
      alert('Abrindo gerenciamento de usuários...');
      // Implementar navegação para página de usuários
    }

    function manageRooms() {
      alert('Abrindo configuração de quartos...');
      // Implementar navegação para página de quartos
    }

    function viewFinancial() {
      alert('Abrindo relatórios financeiros...');
      // Implementar navegação para página financeira
    }

    // Verificar acesso e carregar dados ao inicializar
    document.addEventListener('DOMContentLoaded', function() {
      if (!checkAdminAccess()) {
        return;
      }
      
      carregarDashboard();
      carregarReservasRecentes();
      
      // Atualizar dados a cada 30 segundos
      setInterval(() => {
        carregarDashboard();
        carregarReservasRecentes();
      }, 30000);
    });
  </script>
</body>
</html>